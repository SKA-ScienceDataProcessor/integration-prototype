{
   "$schema":"http://json-schema.org/draft-07/schema#",
   "title":"Scheduling Block Instance",
   "description":"Schema for an SKA Scheduling Block Instance",
   "version":"0.4",
   "type":"object",
   "properties":{
      "id":{
         "description":"SBI-[date]-[project]-[id] for the scheduling block instance id",
         "type":"string",
         "pattern":"^SBI+-[0-9]{8}-[a-z]+-[0-9]+$"
      },
      "version":{
         "description":"Version of the scheduling block instance",
         "type":"string"
      },
      "scheduling_block":{
         "description":"Details of scheduling block",
         "type":"object",
         "properties":{
            "id":{
               "description":"SB-[date]-[project]-[id] for the scheduling block id",
               "type":"string",
               "pattern":"^SB+-[0-9]{8}-[a-z]+-[0-9]+$"
            },
            "project":{
               "description":"Project of the scheduling block instance",
               "type":"string"
            },
            "telescope":{
               "description":"Telescope that will be used for this instance",
               "type":"string"
            },
            "programme_block":{
               "description":"Programme block",
               "type":"string"
            }
         }
      },
      "date_time":{
         "description":"YYYYmmdd HH:MM:DD for the date and time",
         "type":"string",
         "pattern":"^[0-9]{4}[0-9]{2}[0-9]{2} [0-9]{2}:[0-9]{2}:[0-9]{2}"
      },
      "subarray":{
         "description":"[type][id] for the sub array id",
         "type":"string",
         "pattern":"^subarray-[0-9]+$"
      },
      "scans":{
         "description":"Scans",
         "type":"object",
         "properties":{
            "id":{
               "description":"scan-[date]-[id] for the scan id",
               "type":"string",
               "pattern":"^scan+-[0-9]{8}-[0-9]+$"
            }
         }
      },
      "status":{
         "description":"Status of the scheduling block instance",
         "type":"string"
      },
      "processing_blocks":{
         "$ref":"#/definitions/blocks"
      }
   },
   "required":[
      "id",
      "scheduling_block",
      "subarray",
      "scans"
   ],
   "definitions":{
      "blocks":{
         "description":"Array of processing blocks associated with this scheduling block",
         "type":"array",
         "items":{
            "description":"Processing block specification - description of required processing",
            "type":"object",
            "properties":{
               "id":{
                  "description":"PB-[date]-[project]-[id] for the processing block",
                  "type":"string",
                  "pattern":"^PB+-[0-9]{8}-[a-z]+-[0-9]+$"
               },
               "version":{
                  "description":"Version of processing block",
                  "type":"string"
               },
               "type":{
                  "description":"[real-time, batch]",
                  "type":"string"
               },
               "dependencies":{
                  "description":"Dependencies",
                  "type":"array",
                  "items":{

                  }
               },
               "priority":{
                  "description":"The priority of the processing block",
                  "type":"number"
               },
               "resources_required":{
                  "$ref":"#/definitions/resources_required"
               },
               "workflow_id":{
                  "description":"ID of the workflow stage",
                  "type":"string",
                  "pattern":"^[a-z]+-[0-9]+$"
               },
               "workflow_version":{
                  "description":"Version of the workflow stages",
                  "type":"string"
               },
               "status":{
                  "description":"Status of the processing block",
                  "type":"string"
               },
               "workflow_stages":{
                  "$ref":"#/definitions/workflow_stages"
               }
            },
            "required":["id"]
         }
      },
      "resources_required":{
         "description":"Resources required for the processing block, min/max",
         "type":"object",
         "properties":{
            "id":{
               "description":"Resources required ID",
               "type":"string",
               "pattern":"^[a-z]+-[a-z]+-[a-z]+-[0-9]+$"
            }
         }
      },
      "assigned_resources":{
         "description":"Resource allocated for the processing block",
         "type":"object",
         "properties":{
            "status":{
               "description":"Status of the resource assigned",
               "type":"string"
            }
         }
      },
      "ee_config":{
         "description":"Execution Engine parameters, docker-compose file",
         "type":"object",
         "properties":{
            "param1":{
               "description":"Placeholder"
            }
         }
      },
      "app_config":{
         "description":"Detailed config needed by the workflow script/stage",
         "type":"object",
         "properties":{
            "config1":{
               "description":"Placeholder",
               "type":"string"
            }
         }
      },
      "workflow_stages":{
         "description":"Workflow stage",
         "type":"array",
         "properties":{
            "type":{
               "description":"[stage, data, recv, vis, ical, vl]",
               "type":"string"
            },
            "status":{
               "description":"Status of the workflow stage",
               "type":"string"
            },
            "resources_required":{
               "$ref":"#/definitions/resources_required"
            },
            "assigned_resources":{
               "$ref":"#/definitions/assigned_resources"
            },
            "ee_config":{
               "$ref":"#/definitions/ee_config"
            },
            "app_config":{
               "$ref":"#/definitions/app_config"
            }
         },
         "required":["type", "resources_required"]
      }
   }
}