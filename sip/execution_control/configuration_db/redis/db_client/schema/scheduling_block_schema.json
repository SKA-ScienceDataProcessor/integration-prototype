{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "Scheduling Block Instance",
    "description": "Schema for an SKA Scheduling Block Instance (SBI)",
    "version":  "0.3",
    "type": "object",

    "required": [
        "id",
        "scheduling_block_id",
        "sub_array_id",
        "processing_blocks"
    ],

    "properties": {
        "id": {
            "description": "ID in the form [date]-[project]-[type][id]",
            "type": "string",
            "pattern": "^[0-9]{8}-[\\w\\d]+-sbi[0-9]{3}$"
        },
        "scheduling_block_id": {
            "description": "Parent Scheduling Block ID in the form [date]-[project]-[type][id]",
            "type": "string",
            "pattern": "^[0-9]{8}-[\\w|\\d]+-sb[0-9]{3}$"
        },
        "sub_array_id": {
            "description": "Sub-array ID",
            "type": "string",
            "pattern": "^subarray-0[0-9]|subarray-1[0-5]$"
        },
        "processing_blocks" : {
            "description": "Array of Processing block objects",
            "$ref": "#/definitions/blocks"
        },
        "name": {
            "description": "Name (optional)",
            "type": "string"
        },
        "type": {
            "description": "Type of Scheduling Block Instance",
            "type": "string"
        },
        "date": {
            "description": "YYYYmmdd for the date",
            "type": "string",
            "pattern": "^[0-9]{8}$"
        },
        "status": {
            "description": "Status of the Scheduling Block Instance",
            "type": "string"
        },
        "project": {
            "description": "Project name",
            "type": "string"
        }
    },

    "definitions": {
        "blocks": {
            "description": "Array of Processing Blocks",
            "type": "array",
            "items": {
                "description": "Processing Block configuration",
                "type": "object",
                "required": [
                    "id",
                    "resources_requirement",
                    "workflow"
                ],
                "properties": {
                    "id": {
                        "description": "ID in the form [project]-[type][id]",
                        "type": "string",
                        "pattern": "^[a-z]+-[a-z]+[0-9]+$"
                    },
                    "type": {
                        "description": "Type of the processing block",
                        "type": "string"
                    },
                    "priority": {
                        "description": "The Priority of the processing block",
                        "type": "number"
                    },
                    "status": {
                        "description": "Status of the processing block",
                        "type": "string"
                    },
                    "resources_requirement" : {
                        "$ref": "#/definitions/resource_requirement"
                    },
                    "assigned_resources" : {
                        "$ref": "#/definitions/assigned_resources"
                    },
                    "workflow" : {
                        "$ref": "#/definitions/workflow"
                    }
                }
            }
        },

        "resource_requirement": {
            "description": "Resource required for the processing block",
            "type": "object",
            "properties": {
                "storage_type": {
                    "description": "Hot or cold buffer storage type",
                    "type": "string"
                }
            }
        },

        "assigned_resources": {
            "description": "Resource assigned for the processing block",
            "type": "object",
            "properties": {
                "status": {
                    "description": "Status of the resource assigned",
                    "type": "string"
                }
            }
        },

        "workflow": {
            "description": "Workflow stages",
            "type": "object",
            "properties": {
                "status": {
                "description": "Status of the workflow stage",
                "type": "string"
                }
            }
        }
    }
}
